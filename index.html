<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš¡ SolarMap - AnÃ¡lise de Potencial Solar âš¡</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- CSS Customizado -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Container principal -->
    <div id="main-dashboard">
        <!-- Header com vÃ­deo de fundo -->
        <div class="header-container">
            <!-- VÃ­deo de fundo -->
            <video autoplay loop muted class="background-video">
                <source src="assets/video.mp4" type="video/mp4">
            </video>

            <!-- Overlay -->
            <div class="header-overlay"></div>

            <!-- ConteÃºdo do header -->
            <div class="header-content">
                <h1 class="main-title">âš¡ SolarMap - AnÃ¡lise de Potencial Solar âš¡</h1>
                <p class="main-subtitle">
                    Plataforma inteligente para identificaÃ§Ã£o de oportunidades em energia solar fotovoltaica com base em anÃ¡lise geoespacial e dados tÃ©cnicos.
                </p>
            </div>
        </div>

        <!-- Cards de resumo dinÃ¢micos -->
        <div class="summary-cards">
            <div class="summary-card">
                <h4>ğŸ“Š Total de ImÃ³veis</h4>
                <p id="total-imoveis-display">Carregando...</p>
            </div>
            <div class="summary-card">
                <h4>âš¡ ProduÃ§Ã£o Total (kW)</h4>
                <p id="producao-total-display">Carregando...</p>
            </div>
            <div class="summary-card">
                <h4>ğŸ“ˆ MÃ©dia por ImÃ³vel (kW)</h4>
                <p id="media-imovel-display">Carregando...</p>
            </div>
        </div>

        <!-- Filtros -->
        <div class="filter-container">
            <h3>ğŸ” Filtros</h3>
            <div class="filter-grid">
                <div class="filter-group">
                    <label for="bairro-select">Bairros:</label>
                    <select id="bairro-select">
                        <option value="">Carregando...</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="info-select">InformaÃ§Ã£o:</label>
                    <select id="info-select">
                        <option value="capacidade_por_m2">Capacidade por mÂ²</option>
                        <option value="producao_telhado">ProduÃ§Ã£o do Telhado</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Valores:</label>
                    <div class="value-inputs">
                        <input type="number" id="min-value" placeholder="MÃ­n">
                        <input type="number" id="max-value" placeholder="MÃ¡x">
                        <button id="reset-button">ğŸ”„ Limpar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mapa -->
        <div class="map-container">
            <div id="map"></div>
        </div>

        <!-- GrÃ¡ficos lado a lado -->
        <div class="charts-container">
            <div class="chart-box">
                <canvas id="grafico-producao"></canvas>
            </div>
            <div class="chart-box">
                <canvas id="grafico-radiacao"></canvas>
            </div>
        </div>

        <!-- Cards de informaÃ§Ãµes - TÃTULOS CORRIGIDOS -->
        <div class="info-section">
            <h3 class="info-title">ğŸ“‹ Detalhes do ImÃ³vel Selecionado</h3>

            <!-- Grid de informaÃ§Ãµes -->
            <div class="info-grid">
                <!-- Linha 1 -->
                <div class="info-card">
                    <h4>ğŸ  Ãrea (mÂ²)</h4>
                    <p id="area-edificacao-display">0,00</p>
                </div>
                <div class="info-card">
                    <h4>â˜€ï¸ Rad. MÃ¡x (kW/mÂ²)</h4>
                    <p id="radiacao-max-display">0,00</p>
                </div>
                <div class="info-card">
                    <h4>âš¡ Capacidade de ProduÃ§Ã£o de energia/mÂ²</h4>
                    <p id="capacidade-por-m2-display">0,00</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ”‹ Prod. Total (kW)</h4>
                    <p id="producao-telhado-display">0,00</p>
                </div>
                <!-- Linha 2 -->
                <div class="info-card">
                    <h4>ğŸŒ¤ï¸ Prod. Ener DiÃ¡ria da placa em (kWh)</h4>
                    <p id="capacidade-placas-dia-display">0,00</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ“… Prod. Ener Mensal em (kWh)</h4>
                    <p id="capacidade-placas-mes-display">0,00</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ”² Qtd. Placas</h4>
                    <p id="quantidade-placas-display">0</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ“Š Pot. MÃ©dio (kW.dia.mÂ²)</h4>
                    <p id="potencial-medio-dia-display">0,00</p>
                </div>
                <!-- Linha 3 -->
                <div class="info-card">
                    <h4>ğŸ’° Renda Total (R$)</h4>
                    <p id="renda-total-display">0,00</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ‘¤ Renda Per Capita (R$)</h4>
                    <p id="renda-per-capita-display">0,00</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ¡ Renda domiciliar per capita</h4>
                    <p id="renda-domiciliar-per-capita-display">0,00</p>
                </div>
                <div class="info-card invisible"></div>
            </div>
        </div>

        <!-- RelatÃ³rio sÃ­ntese -->
        <div class="relatorio-section">
            <h3 id="relatorio-titulo">ğŸ“Š RelatÃ³rio SÃ­ntese do ImÃ³vel</h3>
            <div class="relatorio-content">
                <p id="relatorio-conteudo">
                    Selecione um imÃ³vel no mapa para visualizar o relatÃ³rio detalhado com todas as informaÃ§Ãµes tÃ©cnicas e de localizaÃ§Ã£o.
                </p>
            </div>

            <!-- BotÃ£o PDF -->
            <div class="pdf-section">
                <button id="btn-gerar-pdf">
                    <i class="fas fa-file-pdf"></i>
                    ğŸ“„ Gerar RelatÃ³rio PDF
                </button>

                <!-- InstruÃ§Ãµes PDF -->
                <div id="pdf-instructions" class="pdf-instructions" style="display: none;">
                    <p>
                        <strong>ğŸ’¡ Como gerar PDF:</strong><br>
                        1. Pressione Ctrl+P (Windows) ou Cmd+P (Mac)<br>
                        2. Selecione 'Salvar como PDF'<br>
                        3. Ajuste as margens para 'MÃ­nimas'<br>
                        4. Clique em 'Salvar'
                    </p>
                </div>
            </div>
        </div>

        <!-- SeÃ§Ã£o de contato -->
        <div class="contact-section">
            <h3>ğŸ“ Contato SolarMap</h3>
            <div class="contact-grid">
                <div class="contact-card">
                    <i class="fab fa-instagram"></i>
                    <h4>Instagram</h4>
                    <a href="https://www.instagram.com/solarmap_/" target="_blank">@solarmap_</a>
                </div>
                <div class="contact-card">
                    <i class="fab fa-whatsapp"></i>
                    <h4>WhatsApp</h4>
                    <a href="https://wa.me/5598986074695" target="_blank">+55 (98) 98607-4695</a>
                </div>
                <div class="contact-card">
                    <i class="fab fa-whatsapp"></i>
                    <h4>WhatsApp</h4>
                    <a href="https://wa.me/5598983331225" target="_blank">+55 (98) 98333-1225</a>
                </div>
                <div class="contact-card">
                    <img src="assets/logo.jpg" alt="SolarMap Logo" class="logo-img">
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>ğŸŒŸ SolarMap - Tecnologia e Sustentabilidade em Energia Solar ğŸŒŸ</p>
        </div>
    </div>

    <!-- Scripts em ordem correta -->
    <!-- IMPORTANTE: SheetJS para leitura de Excel - ADICIONADO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

    <!-- Scripts customizados na ordem correta -->
    <script src="js/dashboard.js"></script>
    <script src="js/map.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/filters.js"></script>

    <!-- InicializaÃ§Ã£o Ãºnica - VERSÃƒO CORRIGIDA -->
    <script>
        // Verificar se todas as dependÃªncias estÃ£o carregadas
        function checkDependencies() {
            const dependencies = [
                { name: 'Leaflet', check: () => typeof L !== 'undefined' },
                { name: 'Chart.js', check: () => typeof Chart !== 'undefined' },
                { name: 'SheetJS', check: () => typeof XLSX !== 'undefined' }
            ];
            
            const missing = dependencies.filter(dep => !dep.check());
            
            if (missing.length > 0) {
                console.warn('âš ï¸ DependÃªncias faltando:', missing.map(d => d.name).join(', '));
                return false;
            }
            
            console.log('âœ… Todas as dependÃªncias carregadas');
            return true;
        }

        // InicializaÃ§Ã£o Ãºnica e robusta
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Inicializando SolarMap Dashboard CORRIGIDO...');

            // Verificar se jÃ¡ foi inicializado
            if (window.dashboardInitialized) {
                console.log('âš ï¸ Dashboard jÃ¡ inicializado, pulando...');
                return;
            }

            // Verificar dependÃªncias
            if (!checkDependencies()) {
                console.error('âŒ DependÃªncias nÃ£o carregadas, tentando novamente em 2s...');
                setTimeout(() => {
                    if (checkDependencies() && typeof initializeDashboard === 'function') {
                        window.dashboardInitialized = true;
                        initializeDashboard();
                    } else {
                        console.error('âŒ Falha ao carregar dependÃªncias apÃ³s timeout');
                    }
                }, 2000);
                return;
            }

            // Marcar como inicializado
            window.dashboardInitialized = true;

            // Inicializar
            if (typeof initializeDashboard === 'function') {
                initializeDashboard();
            } else {
                console.error('âŒ FunÃ§Ã£o initializeDashboard nÃ£o encontrada');
            }
        });

        // Fallback adicional para casos extremos
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (!window.dashboardInitialized && typeof initializeDashboard === 'function') {
                    console.log('ğŸ”„ Executando inicializaÃ§Ã£o fallback...');
                    window.dashboardInitialized = true;
                    initializeDashboard();
                }
            }, 3000);
        });
    </script>
</body>
</html>
